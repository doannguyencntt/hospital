<div mat-dialog-title fxLayout="row" fxLayoutAlign="space-between center" style="margin-bottom: 0px !important;">
    <div style="text-transform: uppercase">
        <div style="float: left;">NGƯỜI BỆNH ĐANG KHÁM</div>
        <div *ngIf="benhNhanHienTai.Id != 0 && benhNhanHienTai.YeuCauKhamBenh.LaThamVan" style="float: right; color: red;"> (DỊCH VỤ KHÁM THAM VẤN)</div>
    </div>
    <button type="button" mat-icon-button mat-dialog-close tabindex="-1">
        <mat-icon [icIcon]="icClose"></mat-icon>
    </button>
</div>

<mat-dialog-content style="min-height: 150px;">
    <ng-container *ngIf="benhNhanHienTai.Id == 0">
        <p class="ml-4 mt-2">Chưa chọn người bệnh</p>
    </ng-container>
    <ng-container *ngIf="benhNhanHienTai.Id != 0">
        <div class="row ml-1 mb-2">
            <fieldset fxFlex="100%" style="background: #e1f5fe;">
                <legend>Thông tin hành chính</legend>
                <div fxFlex="100%" *ngIf="benhNhanHienTai.YeuCauTiepNhan != null">
                    <ul *ngIf="!LaChuyenKhoaKhamNhieu" class="inline">
                        <li>Mã TN:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.MaYeuCauTiepNhan}}</strong>
                        </li>
                        <li>Mã NB:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.BenhNhan.MaBN}}</strong>
                        </li>
                        <li>Họ tên:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.HoTen}}</strong>
                        </li>
                        <li>Giới tính:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.TenGioiTinh}}</strong>
                        </li>
                        <ng-container *ngIf="!isKhamDoan">
                            <li *ngIf="!isDuoi6Tuoi">Tuổi:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.Tuoi}}</strong>
                            </li>
                            <li *ngIf="isDuoi6Tuoi">Tuổi:
                                <strong>{{Duoi6TuoiDisplay}}</strong>
                            </li>
                        </ng-container>
                        <ng-container *ngIf="isKhamDoan">
                            <li>Năm sinh:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.NamSinh}}</strong>
                        </ng-container>

                        <li>SĐT:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.SoDienThoaiDisplay}}</strong>
                        </li>
                        <li>Dân tộc:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.DanToc == null ? null :
                                benhNhanHienTai.YeuCauTiepNhan.DanToc.Ten}}</strong>
                        </li>
                        <li>Địa chỉ:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.DiaChiDisplay}}</strong>
                        </li>
                        <li>Nghề nghiệp:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.NgheNghiep == null ? null :
                                benhNhanHienTai.YeuCauTiepNhan.NgheNghiep.Ten}}</strong>
                        </li>
                        <ng-container *ngIf="!isKhamDoan">
                            <li>Tuyến khám: <strong
                                    style="color: green;">{{benhNhanHienTai.YeuCauTiepNhan.TenLyDoVaoVien}}</strong>
                            </li>
                            <li>Số BHYT: <strong>{{benhNhanHienTai.YeuCauTiepNhan.BHYTMaSoThe}}</strong>
                            </li>
                            <li>Mức hưởng: <strong
                                    style="color: blue;">{{benhNhanHienTai.YeuCauTiepNhan.BHYTMucHuong}}%</strong>
                            </li>
                            <li>Ngày hiệu lực: <strong
                                    [style.color]="benhNhanHienTai.YeuCauTiepNhan.IsBHYTHetHan ? 'red' : ''">{{benhNhanHienTai.YeuCauTiepNhan.BHYTThoiGianHieuLucDisplay}}</strong>
                            </li>

                            <li>Lý do TN:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.TenLyDoTiepNhan}}</strong>
                            </li>
                            <li>Ngày TN:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.ThoiDiemTiepNhanDisplay}}</strong>
                            </li>
                            <li *ngIf="benhNhanHienTai.YeuCauTiepNhan.TrangThaiTiepNhan == yeuCauTiepNhanDangThucHien">
                                <a style="text-decoration: underline; color: blue; float:right;"
                                    (click)="capNhatDoiTuong()"><i>Cập nhật đối tượng</i></a>
                            </li>
                        </ng-container>
                        <ng-container *ngIf="isKhamDoan">
                            <li>Công ty:
                                <strong style="color: red;">{{benhNhanHienTai.YeuCauTiepNhan.TenCongTy}}</strong>
                            </li>
                        </ng-container>
                    </ul>

                    <ul *ngIf="LaChuyenKhoaKhamNhieu" class="inline">
                        <li>Mã TN:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.MaYeuCauTiepNhan}}</strong>
                        </li>
                        <li>Họ tên:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.HoTen}}</strong>
                        </li>
                        <li>Giới tính:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.TenGioiTinh}}</strong>
                        </li>
                        <li>Ngày sinh:
                            <strong>{{benhNhanHienTai.YeuCauTiepNhan.NgaySinhDisplay}}</strong>
                        </li>
                        <li>Mức hưởng: <strong
                                style="color: blue;">{{benhNhanHienTai.YeuCauTiepNhan.BHYTMucHuong}}%</strong>
                        </li>

                        <li style="margin-right: -20px; float:right;">
                            <a style="text-decoration: underline; color: blue;"
                                (click)="showChiTietHanhChinh = !showChiTietHanhChinh">
                                <i>{{showChiTietHanhChinh ? 'Ẩn chi tiết' : 'Xem chi tiết'}}</i>
                            </a>
                        </li>
                    </ul>
                    <ng-container *ngIf="LaChuyenKhoaKhamNhieu && showChiTietHanhChinh">
                        <div style="width:100%"></div>
                        <ul class="inline">
                            <li>Mã NB:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.BenhNhan.MaBN}}</strong>
                            </li>

                            <li>SĐT:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.SoDienThoaiDisplay}}</strong>
                            </li>
                            <li>Dân tộc:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.DanToc == null ? null :
                                    benhNhanHienTai.YeuCauTiepNhan.DanToc.Ten}}</strong>
                            </li>
                            <li>Địa chỉ:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.DiaChiDisplay}}</strong>
                            </li>
                            <li>Nghề nghiệp:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.NgheNghiep == null ? null :
                                    benhNhanHienTai.YeuCauTiepNhan.NgheNghiep.Ten}}</strong>
                            </li>
                            <li>Tuyến khám: <strong
                                    style="color: green;">{{benhNhanHienTai.YeuCauTiepNhan.TenLyDoVaoVien}}</strong>
                            </li>
                            <li>Số BHYT: <strong>{{benhNhanHienTai.YeuCauTiepNhan.BHYTMaSoThe}}</strong>
                            </li>

                            <li>Ngày hiệu lực: <strong
                                    [style.color]="benhNhanHienTai.YeuCauTiepNhan.IsBHYTHetHan ? 'red' : ''">{{benhNhanHienTai.YeuCauTiepNhan.BHYTThoiGianHieuLucDisplay}}</strong>
                            </li>

                            <li>Lý do TN:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.TenLyDoTiepNhan}}</strong>
                            </li>
                            <li>Ngày TN:
                                <strong>{{benhNhanHienTai.YeuCauTiepNhan.ThoiDiemTiepNhanDisplay}}</strong>
                            </li>
                            <li *ngIf="benhNhanHienTai.YeuCauTiepNhan.TrangThaiTiepNhan == yeuCauTiepNhanDangThucHien">
                                <a style="text-decoration: underline; color: blue; float:right;"
                                    (click)="capNhatDoiTuong()"><i>Cập nhật đối tượng</i></a>
                            </li>
                        </ul>
                    </ng-container>
                </div>
            </fieldset>
        </div>

        <div class="row ml-1 temp d-inline">
            <kendo-tabstrip fxFlex="100%" id="card-popup" class="content-has-border tabstrip-pad sticky-kendotab-item-2" (tabSelect)="chuyenDen('card-popup', $event, isKhamDoan)">
                <kendo-tabstrip-tab [selected]="lstStatusSelectTabKhambenh.selectedTabKhamBenh">
                    <ng-template kendoTabTitle>
                        <div kendoTooltip title="Phím tắt: Ctrl + F1">
                            KHÁM BỆNH
                        </div>
                    </ng-template>
                    <ng-template kendoTabContent>
                        <div class="p-2">
                            <app-lan-kham-hien-tai-kham-benh [data]="benhNhanHienTai" [tenKP]="tenKhoaPhong" 
                                [phongKhamId]="phongKhamId" [templateKhamCacCoQuanObj]="benhNhanHienTai.YeuCauKhamBenh.ThongTinKhamTheoDichVuTemplateObj"
                                [isKhamDoan]="isKhamDoan" [laChuyenKhoaKhamNhieu]="LaChuyenKhoaKhamNhieu"
                                [templateDichVuKhamSucKhoes]="benhNhanHienTai.YeuCauKhamBenh.TemplateDichVuKhamSucKhoes"
                                [documentType]="documentType">
                            </app-lan-kham-hien-tai-kham-benh>


                            <div class="sticky-button-action py-3 text-right" kendoTooltip>
                                <button type="button" mat-button class="mr-2" *ngIf="isKhamDoan ||benhNhanHienTai.YeuCauKhamBenh.IsChangeKhamBenh" (click)="cancelChangeData()" title="Phím tắt: Esc">Hủy</button>
                                <button type="button" class="mr-2" color="primary" mat-raised-button *ngIf="isKhamDoan || benhNhanHienTai.YeuCauKhamBenh.IsChangeKhamBenh" (click)="saveChangeData(null, true)" title="Phím tắt: Ctrl + S">Lưu</button>
                            </div>
                        </div>

                    </ng-template>
                </kendo-tabstrip-tab>
                <kendo-tabstrip-tab [selected]="lstStatusSelectTabKhambenh.selectedTabLichSuKham">
                    <ng-template kendoTabTitle>
                        <div kendoTooltip title="Phím tắt: Ctrl + F2">
                            LỊCH SỬ KHÁM 
                        </div>
                    </ng-template>
                    
                    <ng-template kendoTabContent>
                        <app-kham-benh-lich-su-kham-list [BenhNhan]="benhNhanHienTai.YeuCauTiepNhan.BenhNhanId" [tenKP]="tenKhoaPhong" 
                            [YeuCauTiepNhanId]="benhNhanHienTai.YeuCauTiepNhanId" [documentType]="documentType">
                        </app-kham-benh-lich-su-kham-list>
                    </ng-template>
                </kendo-tabstrip-tab>

                <!-- tab chỉ định -->
                <kendo-tabstrip-tab [selected]="lstStatusSelectTabKhambenh.selectedTabChiDinh">
                    <ng-template kendoTabTitle>
                        <div kendoTooltip title="Phím tắt: Ctrl + F3">
                            CHỈ ĐỊNH
                        </div>
                    </ng-template>
                    <ng-template kendoTabContent>
                        <div class="m-2">
                            <app-lan-kham-hien-tai-kham-benh-chi-dinh [data]="benhNhanHienTai" [templateKp]="templateKhoaPhong" [tenKp]="tenKhoaPhong" 
                                [isKhamDoan]="isKhamDoan" [hinhThucKhamBenh]="hinhThucKham" [documentType]="documentType">
                            </app-lan-kham-hien-tai-kham-benh-chi-dinh>
                        </div>
                    </ng-template>
                </kendo-tabstrip-tab>

                <!-- tab kết quả cls -->
                <kendo-tabstrip-tab [selected]="lstStatusSelectTabKhambenh.selectedTabKetQuaCLS">
                    <ng-template kendoTabTitle>
                        <div kendoTooltip title="Phím tắt: Ctrl + F5">
                            KQ CLS
                        </div>
                    </ng-template>
                    <ng-template kendoTabContent>
                        <div class="mt-2 ml-2 mr-2">
                            <app-lan-kham-hien-tai-ket-qua-cls  [YeuCauTiepNhanId]="benhNhanHienTai.YeuCauTiepNhanId"
                                [documentType]="documentType">
                            </app-lan-kham-hien-tai-ket-qua-cls>
                        </div>
                    </ng-template>
                </kendo-tabstrip-tab>


                <kendo-tabstrip-tab *ngIf="!isKhamDoan" [selected]="lstStatusSelectTabKhambenh.selectedTabChanDoan">
                    <ng-template kendoTabTitle>
                        <div kendoTooltip title="Phím tắt: Ctrl + F6">
                            CHẨN ĐOÁN
                        </div>
                    </ng-template>
                    <ng-template kendoTabContent>
                        <div class="p-2">
                            <app-lan-kham-hien-tai-ket-luan [data]="benhNhanHienTai" [dataYeuCauKhamBenh]="benhNhanHienTai.YeuCauKhamBenh" 
                                [dataICDKhacs]="benhNhanHienTai.YeuCauKhamBenh.YeuCauKhamBenhICDKhacs" [dataYeuCauKhamBenhPrevious]="yeuCauKhamBenhPrevious" 
                                [validationErrors]="validationKetLuanErrors" [documentType]="documentType">
                            </app-lan-kham-hien-tai-ket-luan>

                            <div class="sticky-button-action py-3 text-right" kendoTooltip>
                                <button (click)="huy()" type="button" *ngIf="this.benhNhanHienTai.YeuCauKhamBenh.IsChangeChanDoan" color="primary" mat-stroked-button mat-button class="mr-1 mt-2" title="Phím tắt: Esc">Hủy</button>
                                <button (click)="luuKetLuan()" type="button" *ngIf="this.benhNhanHienTai.YeuCauKhamBenh.IsChangeChanDoan" color="primary" mat-raised-button mat-button class="mr-1 mt-2" title="Phím tắt: Ctrl + S">Lưu</button>
                                
                                <button type="button" color="primary" *ngIf="this.benhNhanHienTai.YeuCauKhamBenh.DichVuKhamBenhBenhVienId == cauHinhDichVuKhamThai" mat-raised-button mat-button class="mr-1" (click)="inGiayNghiDuongThai()">In giấy nghỉ dưỡng thai
                                </button>

                                <button type="button" color="primary" mat-raised-button mat-button class="mr-1" [disabled]="benhNhanHienTai.YeuCauKhamBenh.CoDieuTriNgoaiTru == true" (click)="hoanThanhKham()" title="Phím tắt: Ctrl + H">Lưu và Hoàn thành
                                    khám</button>

                                <button type="button" color="primary" mat-raised-button mat-button class="mr-1" (click)="inPhieuKham()">In phiếu khám
                                    bệnh</button>

                                <button *ngIf="this.benhNhanHienTai.YeuCauKhamBenh.CoNhapVien" type="button" color="primary" mat-raised-button mat-button class="mr-1" (click)="inPhieuKhamVaoVien()">In phiếu khám
                                        bệnh vào viện</button>
                                <button type="button" color="primary" *ngIf="this.benhNhanHienTai.YeuCauTiepNhan.CoBHYT == true" mat-raised-button mat-button class="mr-1" (click)="inGiayNghiHuongBHXH()">In giấy nghỉ
                                    hưởng BHXH</button>
                                   
                            </div>
                        </div>
                    </ng-template>
                </kendo-tabstrip-tab>
                <!-- số dư tạm ứng -->
                <kendo-tabstrip-tab [disabled]="true" cssClass="tab-right-po">
                    <ng-template kendoTabTitle>
                        Tạm ứng:
                        <b>{{benhNhanHienTai.YeuCauKhamBenh.SoDuTaiKhoanDisplay}}</b>
                        -
                        Còn lại: <b>{{benhNhanHienTai.YeuCauKhamBenh.SoDuTaiKhoanConLaiDisplay}}</b>
                    </ng-template>
                    <ng-template kendoTabContent>
                    </ng-template>
                </kendo-tabstrip-tab>
            </kendo-tabstrip>
        </div>
    </ng-container>
</mat-dialog-content>

<mat-dialog-actions fxLayoutAlign="end center" fxLayoutGap="8px">
    <button type="button" mat-stroked-button color="primary" [mat-dialog-close]="null">Hủy</button>
</mat-dialog-actions>