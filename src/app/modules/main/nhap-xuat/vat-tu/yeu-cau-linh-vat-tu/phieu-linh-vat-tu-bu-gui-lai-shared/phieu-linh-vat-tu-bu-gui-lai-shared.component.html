<div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="16px grid" fxLayoutGap.lt-sm="0"
    fxLayoutAlign="space-between">

    <div fxFlex="100%" *ngIf="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai == false">
        <h4 style="color: red;">Lý do: {{yeuCauLinhBuVatTu.LyDoKhongDuyet}}</h4>
    </div>
    <!-- [disabled]="!isCreate && trangThaiVo != undefined && trangThaiVo != null && (trangThaiVo.TrangThai == true ||
    trangThaiVo.TrangThai == false) || yeuCauLinhBuVatTu.LaNguoiTaoPhieu == false" -->
    <app-combobox *ngIf="yeuCauLinhBuVatTu.LaNguoiTaoPhieu == false" id="linhTuKho" fxFlex="25%" fxFlex.sm="25%"
        [required]="true" url="YeuCauLinhVatTu/GetKhoLinhVatTu" [(model)]="yeuCauLinhBuVatTu.KhoXuatId"
        [modelText]="yeuCauLinhBuVatTu.TenKhoXuat" label="Lĩnh từ kho" [disabled]="true" class="item-no-padding"
        (modelChange)="linhTuKhoChange($event)" [bind]="true">
    </app-combobox>

    <app-combobox *ngIf="yeuCauLinhBuVatTu.LaNguoiTaoPhieu == false" id="linhVeKho" fxFlex="25%" fxFlex.sm="25%"
        [required]="true" [(model)]="yeuCauLinhBuVatTu.KhoNhapId" [modelText]="yeuCauLinhBuVatTu.TenKhoNhap"
        [disabled]="true" label="Lĩnh về kho" (modelChange)="linhVeKhoChange($event)" class="item-no-padding">
    </app-combobox>

    <!-- [disabled]="!isCreate && trangThaiVo != undefined && trangThaiVo != null && (trangThaiVo.TrangThai == true || trangThaiVo.TrangThai == false)" -->
    <app-combobox *ngIf="yeuCauLinhBuVatTu.LaNguoiTaoPhieu == null || yeuCauLinhBuVatTu.LaNguoiTaoPhieu == true"
        id="linhTuKho" fxFlex="25%" fxFlex.sm="25%" [required]="true" url="YeuCauLinhVatTu/GetKhoLinhVatTu"
        [queryInfo]="{ParameterDependencies:'{KhoId:' + linhTuKhoId +'}', Take: 50}"
        [(model)]="yeuCauLinhBuVatTu.KhoXuatId" [modelText]="yeuCauLinhBuVatTu.TenKhoXuat" label="Lĩnh từ kho"
        [disabled]="true" class="item-no-padding" (modelChange)="linhTuKhoChange($event)" [bind]="true"
        [validationerror]="'KhoXuatId' | validationerror:validationErrorsLinhBu">
    </app-combobox>

    <!-- [disabled]="!isCreate && trangThaiVo != undefined && trangThaiVo != null && (trangThaiVo.TrangThai == true || trangThaiVo.TrangThai == false)" -->
    <app-combobox *ngIf="yeuCauLinhBuVatTu.LaNguoiTaoPhieu == null || yeuCauLinhBuVatTu.LaNguoiTaoPhieu == true"
        id="linhVeKho" fxFlex="25%" fxFlex.sm="25%" [required]="true" [bind]="true"
        [queryInfo]="{ParameterDependencies:'{KhoId:' + linhVeKhoId +'}', Take: 50}"
        [(model)]="yeuCauLinhBuVatTu.KhoNhapId" [modelText]="yeuCauLinhBuVatTu.TenKhoNhap" [disabled]="true"
        url="YeuCauLinhVatTu/GetKhoCurrentUserLinhBuVatTu" label="Lĩnh về kho" (modelChange)="linhVeKhoChange($event)"
        class="item-no-padding" [validationerror]="'KhoNhapId' | validationerror:validationErrorsLinhBu">
    </app-combobox>


    <app-textbox id="nguoiYeuCau"
        [fxFlex]="!isCreate && trangThaiVo != null && (trangThaiVo.TrangThai == true || trangThaiVo.TrangThai == false) ? '13%' : '25%'"
        [fxFlex.sm]="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai != null ? '13%' : '25%'"
        [required]="true" [(model)]="yeuCauLinhBuVatTu.HoTenNguoiYeuCau" maxlength="250" label="Người yêu cầu"
        disabled={{true}}>
    </app-textbox>
    <app-datepicker id="ngayYeuCau"
        [fxFlex]="!isCreate && trangThaiVo != null && (trangThaiVo.TrangThai == true || trangThaiVo.TrangThai == false) ? '12%' : '25%'"
        [fxFlex.sm]="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai != null ? '12%' : '25%'"
        [(model)]="yeuCauLinhBuVatTu.NgayYeuCau" disabled={{true}} [required]="true" label="Ngày yêu cầu">
    </app-datepicker>

    <app-textbox
        *ngIf="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai != false && trangThaiVo.TrangThai != null"
        id="nguoiPheDuyet" fxFlex="13" fxFlex.sm="13" maxlength="250" label="Người phê duyệt"
        [(model)]="yeuCauLinhBuVatTu.TenNhanVienDuyet" disabled={{true}} [required]="true">
    </app-textbox>

    <app-datepicker
        *ngIf="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai != false && trangThaiVo.TrangThai != null"
        id="ngayDuyet" fxFlex="12" fxFlex.sm="12" [required]="true" label="Ngày duyệt"
        [(model)]="yeuCauLinhBuVatTu.NgayDuyet" disabled={{true}}>
    </app-datepicker>

    <app-textbox *ngIf="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai == false" id="nguoiPheDuyet"
        fxFlex="13" fxFlex.sm="13" maxlength="250" label="Người từ chối duyệt"
        [(model)]="yeuCauLinhBuVatTu.TenNhanVienDuyet" disabled={{true}} [required]="true">
    </app-textbox>

    <app-datepicker *ngIf="!isCreate && trangThaiVo != null && trangThaiVo.TrangThai == false" id="ngayDuyet"
        fxFlex="12" fxFlex.sm="12" [required]="true" label="Ngày từ chối duyệt" [(model)]="yeuCauLinhBuVatTu.NgayDuyet"
        disabled={{true}}>
    </app-datepicker>


    <app-textarea id="ghiChu" fxFlex="100" fxFlex.sm="100" maxlength="4000" label="Ghi chú" minHeight="20"
        [disabled]="!isCreate && trangThaiVo != undefined && trangThaiVo != null && (trangThaiVo.TrangThai == true || trangThaiVo.TrangThai == false) || yeuCauLinhBuVatTu.LaNguoiTaoPhieu == false"
        [(model)]="yeuCauLinhBuVatTu.GhiChu">
    </app-textarea>

    <h3 fxFlex="100%" class="sub-title mt-0">Thông tin vật tư</h3>
    <ng-container *ngIf="isCreate">
        <app-datetimepicker fxFlex="15%" [(model)]="yeuCauLinhBuDuocPhamSearch.ThoiDiemChiDinhTuFormat" #tiepnhantu
            id="ThoiDiemChiDinhTuFormat" (modelChange)="thoiDiemTNChange()" label="Từ ngày chỉ định" class="on-header">
        </app-datetimepicker>
        <app-datetimepicker fxFlex="15%" [(model)]="yeuCauLinhBuDuocPhamSearch.ThoiDiemChiDinhDenFormat" #tiepnhanden
            id="ThoiDiemChiDinhDenFormat" (modelChange)="thoiDiemTNChange()" label="đến ngày chỉ định"
            class="on-header">
        </app-datetimepicker>
        <div fxFlex="70%" fxHide.sm></div>
    </ng-container>
    <div fxFlex="100%" fxLayoutAlign="end center"
        [style.display]="(trangThaiVo != undefined && trangThaiVo != null  && (trangThaiVo.TrangThai == null || trangThaiVo.TrangThai == true) || isCreate) ? 'block' : 'none'">
        <app-grid fxFlex="100%" fxFlex.sm="100%" style="width: 1px;" [gridColumns]="gridColumns"
            [allowSortDefault]="true" [documentType]="documentType" [useAddDeault]="false" #gridVatTu
            (extOnDataBound)="onDataBoundGrid($event)" [urlGetData]="urlGetDataGrid"
            [showStt]="trangThaiVo != undefined && trangThaiVo != null && trangThaiVo.TrangThai == true ? true : false"
            [urlGetTotalPage]="urlGetTotalPageGrid" [useHeaderDefault]="false" [useActionDefault]="false"
            [checkboxAble]="false" [lazyLoadPage]="true" maxHeight="500" [pageable]="false"
            [detailTemplate]="detailTemplate" [additionalSearchString]="dieuKienLoadGridVatTu">
        </app-grid>
        <ng-template #detailTemplate let-dataItem>
            <app-grid style="width: 1px;" [gridColumns]="gridChildColumns" [allowSortDefault]="true"
                [documentType]="documentType" [useAddDeault]="false" [useHeaderDefault]="false"
                [useActionDefault]="false" [checkboxAble]="false" [lazyLoadPage]="true" maxHeight="500"
                [pageable]="true" [pageSize]="10" [urlGetData]="urlGetDataGridChild"
                [urlGetTotalPage]="urlGetTotalPageGridChild" [sort]="sortChild" [showStt]="true"
                [additionalSearchString]="phieuLinhId + ';' 
                + dataItem.VatTuBenhVienId + ';' 
                + dataItem.LaBHYT + ';' 
                + isCreate + ';' 
                + yeuCauLinhBuVatTu.KhoNhapId + ';' 
                +(trangThaiVo != undefined && trangThaiVo != null && trangThaiVo.TrangThai) + ';' 
                + dataItem.SoLuongTon + ';'
                + yeuCauLinhBuDuocPhamSearch.ThoiDiemChiDinhTu + ';'
                + yeuCauLinhBuDuocPhamSearch.ThoiDiemChiDinhDen + ';'">
            </app-grid>
        </ng-template>
    </div>

    <div fxFlex="100%" fxLayoutAlign="end center"
        [style.display]="(trangThaiVo != undefined && trangThaiVo != null  && trangThaiVo.TrangThai == false ) ? 'block' : 'none'">
        <app-grid fxFlex="100%" fxFlex.sm="100%" style="width: 1px;" [gridColumns]="gridColumns"
            [allowSortDefault]="true" [documentType]="documentType" [useAddDeault]="false" #gridVatTuTuChoi
            (extOnDataBound)="onDataBoundGrid($event)" [urlGetData]="urlGetDataGrid" [showStt]="true"
            [urlGetTotalPage]="urlGetTotalPageGrid" [useHeaderDefault]="false" [useActionDefault]="false"
            [checkboxAble]="false" [lazyLoadPage]="true" maxHeight="500" [pageable]="false"
            [additionalSearchString]="dieuKienLoadGridVatTu">
        </app-grid>
    </div>

    <ng-template #STTTemplate let-rowIndex="rowIndex">
        {{rowIndex + 1}}
    </ng-template>
    <ng-template #STTTemplateChild let-rowIndex="rowIndex">
        {{rowIndex + 1}}
    </ng-template>
    <ng-template #nhomGroupHeaderTemplate let-value="value">
        <strong>{{value}}</strong>
    </ng-template>

    <ng-template #slYeuCauTemplate let-dataItem let-rowIndex="rowIndex">
        <div>
            <span fxFlex="70%">
                {{dataItem.SoLuongTon}}
            </span>
            <mat-icon class="icon-war-status-grid"
                *ngIf="dataItem.SoLuongTon != null && yeuCauLinhBuVatTu.KhoXuatId != null && dataItem.SoLuongCanBu > dataItem.SoLuongTon"
                fxFlex="30%" [icIcon]="icWarning" kendoTooltip title="Số lượng tồn ít hơn số lượng bù">
            </mat-icon>
        </div>
    </ng-template>

    <ng-template #slYeuCauLinhThucTeTemplate let-dataItem let-rowIndex="rowIndex">
        <app-textboxnumeric
            *ngIf="(trangThaiVo != undefined && trangThaiVo != null && trangThaiVo.TrangThai == null) || trangThaiVo == undefined"
            [fxFlex]="dataItem.SLYeuCauLinhThucTe > 0 ? '100%' : '70%'" [(model)]="dataItem.SLYeuCauLinhThucTe"
            [required]="true" min="0" label=" " (modelChange)="ganSLThucTeChange($event, dataItem.VatTuBenhVienId)"
            [validationerror]="'YeuCauVatTuBenhViens['+rowIndex+'].SLYeuCauLinhThucTe' | validationerror:validationErrorsLinhBu">
            <!-- [max]="dataItem.SLYeuCauLinhThucTeMax"  -->
        </app-textboxnumeric>
        <mat-icon class="icon-war-status-grid" *ngIf="dataItem.SLYeuCauLinhThucTe == 0" fxFlex="30%"
            [icIcon]="icWarning" kendoTooltip title="Sẽ không tạo lĩnh bù cho vật tư này.">
        </mat-icon>
        <div *ngIf="trangThaiVo != undefined && trangThaiVo != null && trangThaiVo.TrangThai != null">
            {{dataItem.SLYeuCauLinhThucTe}}
        </div>
    </ng-template>

    <ng-template #checkBoxTemplate let-dataItem>
        <app-checkbox id="vehicle1-{{dataItem.VatTuBenhVienId}}" value="true" [(model)]="dataItem.CheckBox"
            (modelChange)="checkBoxDichVu(dataItem, $event)" label=" " class="pl-2">
        </app-checkbox>
    </ng-template>

    <ng-template #checkBoxHeaderTemplate let-dataItem>
        <app-checkbox id="vehicle1" name="vehicle1" value="true" [(model)]="checkAll"
            (modelChange)="checkBoxAllChange($event)" label=" " class="pl-2">
        </app-checkbox>
    </ng-template>
</div>